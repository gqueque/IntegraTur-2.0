{% extends "cadastro_evento/base.html" %}
{% load static %}

{% block conteudo %}
<div class="content" style="padding: 0;">
    <div id="map" style="width: 100vw; height: 100vh; margin: 0; padding: 0;"></div>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdV3seSOOBkqraltqD7TTh4U3FGC3pEC0&callback=inicializarMapa" async defer></script>

<script>
    let mapa;

    function inicializarMapa() {
        mapa = new google.maps.Map(document.getElementById('map'), {
            center: { lat: -8.0476, lng: -34.8770 }, // Recife centro
            zoom: 12
        });

        const eventos = {{ eventos_json|safe }};

        const infoWindow = new google.maps.InfoWindow();

        eventos.forEach(evento => {
            if (evento.latitude && evento.longitude) {
                const marcador = new google.maps.Marker({
                    position: { lat: parseFloat(evento.latitude), lng: parseFloat(evento.longitude) },
                    map: mapa,
                    title: evento.titulo
                });

                const conteudo = `
        <div style="
        background-color: white;
        padding: 8px;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        max-width: 200px;
        font-family: Arial, sans-serif;
    ">
        <img src="${evento.imagem}" alt="${evento.nome}" style="width: 100%; height: 90px; object-fit: cover; border-radius: 4px; margin-bottom: 6px;">
        <h3 style="margin: 0; font-size: 14px;">${evento.nome}</h3>
        <p style="margin: 4px 0; font-size: 12px;"><strong>Data:</strong> ${evento.data}</p>
        <button onclick="window.location.href='/eventos/${evento.id}'" style="
            background-color: black;
            color: white;
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
        ">+Detalhes</button>
    </div>
    `;

    


                marcador.addListener('click', () => {
                    infoWindow.setContent(conteudo);
                    infoWindow.open(mapa, marcador);
                });
            }
        });

        mapa.addListener('click', () => {
            infoWindow.close();
        });
    }
</script>

{% endblock %}
